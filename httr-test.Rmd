
```{r}
library(httr2)
library(rvest)
library(tidyverse)
library(lubridate)
source("teams_fns.R")
source("soccerway_fns.R")
source("comp_fns.R")
source("update.R")
```

initialize games, teams, comps to empty

```{r}
# initial game numbers
# games <- game_numbers_to_info()
```


initialize from nothing 

```{r}
game_id <- sample(3510000:3540000, 5)
games <- game_numbers_to_info(game_id)
games
```

some teams

```{r}
team_id <- sample(1:50000, 5)
team_id
teams <- numbers_to_team(team_id)
teams
```

some comps

```{r}
comp_id <- sample(50000:60000, 5)
comp_id
comps <- numbers_to_comp(comp_id)
comps
```
## initialize from previous

```{r}
games <- read_rds("games.rds")
teams <- read_rds("teams.rds")
comps <- read_rds("comps.rds")
```


## update


```{r}
# game_ids <- sample(3510000:3540000, 5)
start_game <- 3554028
lo <- start_game - 100
hi <- start_game + 50
# game_ids
games <- update_games(lo:hi, games)
# games <- update_games(game_ids, games)
games
```

update teams

```{r}
teams <- update_teams(teams, games)
teams
```

update comps

```{r}
comps <- update_comps(comps, games) # this can fail if no comp ids to add (check inside)
comps
```




display games

```{r}
games %>% 
  left_join(teams, by = c("t1"="id")) %>% 
  left_join(teams, by = c("t2"="id")) %>% 
  left_join(comps, by = c("comp" = "comp_id")) %>% 
  select(game, home_team = name.x, away_team = name.y, score, status, where, comp_name, timestamp) %>% 
  arrange(game) %>% View()
```

## save games

```{r}
write_rds(games, "games.rds")
write_rds(teams, "teams.rds")
write_rds(comps, "comps.rds")
```

